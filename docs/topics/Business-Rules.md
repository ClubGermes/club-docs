# Неочевидные бизнес-правила (Hidden Gems)

В ходе анализа кода были выявлены правила и особенности, которые не всегда следуют из документации API, но критически важны для работы системы.

## 1. Захардкоженные ID пользователей (Super Admins)

В системе `club-api` существуют проверки, завязанные на конкретные ID пользователей. Это "супер-пользователи", которые получают доступ к отчетам или административным функциям в обход стандартной ролевой модели.

**Ключевые ID:**
*   `10069`: Основной технический администратор.
*   `10004`, `10298`, `10170`: Дополнительные ID с расширенными правами.

**Где это встречается:**
*   `backend/apps/club-api/app/routes/endpoints/report.py`: Доступ к выгрузке отчетов.
*   `backend/apps/club-api/app/routes/endpoints/meetings.py`: Специальные права в модуле встреч.
*   `backend/apps/club-api/app/helpers/push.py`: Список получателей системных уведомлений.

## 2. Статусы участия (`audit_status`)

Для регистрации на события используется поле `audit`. Хотя в коде оно может называться по-разному, стандартные значения следующие:

*   **0 (`REGISTERED` / `WAITING`):** Пользователь нажал "Пойду", но его участие еще не подтверждено или событие открытое.
*   **1 (`CONFIRMED`):** Менеджер подтвердил заявку (актуально для закрытых мероприятий).
*   **2 (`ATTENDED` / `VISITED`):** Пользователь физически посетил мероприятие (отметка через QR-код).

> **Важно:** Доступ к материалам события (ссылки на записи, презентации) часто проверяется условием `audit >= 1`.

## 3. Идемпотентность регистраций

При повторном вызове метода регистрации на то же самое событие система `club-api` (и планируемый `club-events`) не возвращает ошибку. Вместо этого она возвращает данные существующей записи. Это позволяет фронтенду быть проще и не обрабатывать ошибки "Вы уже записаны".

## 4. Шифрование персональных данных (Legacy)

В старой части системы (`club-api`) email и номера телефонов могут храниться в зашифрованном виде.
*   Используется расширение PostgreSQL `pgcrypto`.
*   В SQL-запросах можно встретить функции `pgp_sym_decrypt`.
*   Ключ шифрования обычно передается через переменные окружения или конфиг.
